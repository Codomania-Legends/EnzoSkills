<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Private Chat Rooms ğŸ¤</title>
        <script src="/socket.io/socket.io.js"></script>
    </head>
    <body>
        <h1>Secret Chat Room ğŸ•µï¸</h1>

        <div id="lobby">
            <button onclick="createRoom()">Create New Room ğŸ†•</button>
            <br /><br />
            <input type="text" id="roomInput" placeholder="Enter Room ID..." />
            <button onclick="joinRoom()">Join Room ğŸšª</button>
        </div>

        <div id="chat" style="display: none">
            <h2 id="roomDisplay"></h2>
            <div
                id="messages"
                style="
                    border: 1px solid #ccc;
                    height: 300px;
                    overflow-y: scroll;
                    margin-bottom: 10px;
                    padding: 10px;
                "
            ></div>
            <input type="text" id="msgInput" placeholder="Type a message..." />
            <button onclick="sendMessage()">Send ğŸ“©</button>
        </div>

        <script>
            const socket = io();
            let currentRoomId = null;

            // 1. Create Room Function ğŸ—ï¸
            function createRoom() {
                socket.emit("create_room");
            }

            // Listen for the unique ID from server
            socket.on("room_created", (id) => {
                currentRoomId = id;
                enterChatMode(id);
                alert(`Room Created! Share this ID: ${id} ğŸ“‹`);
            });

            // 2. Join Room Function ğŸ”—
            function joinRoom() {
                const id = document.getElementById("roomInput").value;
                if (id) {
                    currentRoomId = id;
                    socket.emit("join_room", id);
                    enterChatMode(id);
                }
            }

            // 3. Send Message Function ğŸ“¤
            function sendMessage() {
                const msg = document.getElementById("msgInput").value;
                if (msg && currentRoomId) {
                    // Send message AND room ID to server
                    socket.emit("send_message", {
                        roomId: currentRoomId,
                        message: msg,
                    });
                    document.getElementById("msgInput").value = "";
                }
            }

            // Listen for incoming messages ğŸ“¥
            socket.on("receive_message", (msg) => {
                const msgDiv = document.createElement("div");
                msgDiv.textContent = msg;
                document.getElementById("messages").appendChild(msgDiv);
            });

            socket.on("user_joined", (msg) => {
                const notif = document.createElement("div");
                notif.style.color = "green";
                notif.style.fontStyle = "italic";
                notif.textContent = msg;
                document.getElementById("messages").appendChild(notif);
            });

            // Helper to switch views ğŸ”„
            function enterChatMode(id) {
                document.getElementById("lobby").style.display = "none";
                document.getElementById("chat").style.display = "block";
                document.getElementById("roomDisplay").textContent =
                    `Connected to Room: ${id} âœ…`;
            }
        </script>
    </body>
</html>
